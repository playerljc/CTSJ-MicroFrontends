{"version":3,"file":"component.js","sources":["component.js"],"sourcesContent":["\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.createComponent = void 0;\r\nvar react_1 = __importDefault(require(\"react\"));\r\nvar react_loading_skeleton_1 = __importDefault(require(\"react-loading-skeleton\"));\r\nvar context_1 = __importDefault(require(\"./context\"));\r\n/**\r\n * loadScript\r\n * @param script\r\n * @return Promise\r\n */\r\nfunction loadScript(script) {\r\n    return new Promise(function (resolve) {\r\n        var el = document.createElement('script');\r\n        el.addEventListener('load', function () {\r\n            resolve();\r\n        });\r\n        el.src = script;\r\n        document.getElementsByTagName('head')[0].appendChild(el);\r\n    });\r\n}\r\n/**\r\n * loadLink\r\n * @param link\r\n * @return Promise\r\n */\r\nfunction loadLink(link) {\r\n    return new Promise(function (resolve) {\r\n        var el = document.createElement('link');\r\n        el.setAttribute('rel', 'stylesheet');\r\n        el.addEventListener('load', function () {\r\n            resolve();\r\n        });\r\n        el.href = link;\r\n        document.getElementsByTagName('head')[0].appendChild(el);\r\n    });\r\n}\r\n// @ts-ignore\r\n/**\r\n * loadRemoteResource - 加载远程资源\r\n * @param scripts\r\n * @param links\r\n * @return Promise\r\n */\r\nfunction loadRemoteResource(_a) {\r\n    var scripts = _a.scripts, links = _a.links;\r\n    // @ts-ignore\r\n    return Promise.all([].concat(\r\n    // @ts-ignore\r\n    (scripts || []).map(function (script) { return loadScript(script); }), (links || []).map(function (link) { return loadLink(link); })));\r\n}\r\n/**\r\n * createComponent\r\n * @param config\r\n * @param container\r\n * @return React.ReactElement\r\n */\r\nfunction createComponent(config, container) {\r\n    // @ts-ignore\r\n    return /** @class */ (function (_super) {\r\n        __extends(ComponentWrap, _super);\r\n        function ComponentWrap(props) {\r\n            var _this = _super.call(this, props) || this;\r\n            _this.el = null;\r\n            _this.lock = false;\r\n            _this.state = {\r\n                isReady: false,\r\n            };\r\n            _this.refresh = _this.refresh.bind(_this);\r\n            return _this;\r\n        }\r\n        ComponentWrap.prototype.componentDidMount = function () {\r\n            var _this = this;\r\n            var _a, _b, _c;\r\n            // 1.接收到props中的history对象\r\n            var history = this.props.history;\r\n            // 2. 使用history的listen方法添加自定义监听事件 参数为一个回调函数 即：路由改变之后执行的方法\r\n            this.unListen = history.listen(function (location) {\r\n                console.log('pathChange', location);\r\n            });\r\n            var name = config.name;\r\n            // 如果没有加载远程资源，则加载远程资源\r\n            // @ts-ignore\r\n            if (!window[name]) {\r\n                var scripts = config.scripts, links = config.links;\r\n                loadRemoteResource({\r\n                    scripts: scripts,\r\n                    // @ts-ignore\r\n                    links: links,\r\n                }).then(function () {\r\n                    var _a, _b, _c;\r\n                    // @ts-ignore\r\n                    (_a = window[name]) === null || _a === void 0 ? void 0 : _a.bootstrap({\r\n                        props: _this.props,\r\n                        config: config,\r\n                        el: _this.el || container,\r\n                        refresh: _this.refresh,\r\n                    });\r\n                    // @ts-ignore\r\n                    (_c = (_b = window[name]) === null || _b === void 0 ? void 0 : _b.mount()) === null || _c === void 0 ? void 0 : _c.then(function () {\r\n                        _this.setState({\r\n                            isReady: true,\r\n                        });\r\n                    });\r\n                });\r\n            }\r\n            // 加载过远程资源\r\n            else {\r\n                // @ts-ignore\r\n                (_a = window[name]) === null || _a === void 0 ? void 0 : _a.bootstrap({\r\n                    props: this.props,\r\n                    config: config,\r\n                    el: this.el || container,\r\n                    refresh: this.refresh,\r\n                });\r\n                // @ts-ignore\r\n                (_c = (_b = window[name]) === null || _b === void 0 ? void 0 : _b.mount()) === null || _c === void 0 ? void 0 : _c.then(function () {\r\n                    _this.setState({\r\n                        isReady: true,\r\n                    });\r\n                });\r\n            }\r\n        };\r\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n        ComponentWrap.prototype.componentDidUpdate = function (prevProps, prevState, snapshot) {\r\n            var _a;\r\n            console.log('prevState.isReady', prevState.isReady);\r\n            console.log('this.state.isReady', this.state.isReady);\r\n            var lock = this.lock;\r\n            if (lock) {\r\n                this.lock = false;\r\n            }\r\n            else if (prevState.isReady === this.state.isReady) {\r\n                var name_1 = config.name;\r\n                // @ts-ignore\r\n                (_a = window[name_1]) === null || _a === void 0 ? void 0 : _a.update(prevProps, this.props);\r\n            }\r\n        };\r\n        ComponentWrap.prototype.componentWillUnmount = function () {\r\n            var _a;\r\n            this.unListen();\r\n            var name = config.name;\r\n            // @ts-ignore\r\n            (_a = window[name]) === null || _a === void 0 ? void 0 : _a.unmount();\r\n        };\r\n        /**\r\n         * refresh - 刷新\r\n         */\r\n        ComponentWrap.prototype.refresh = function () {\r\n            // 加锁防止自己被update\r\n            this.lock = true;\r\n            this.forceUpdate();\r\n        };\r\n        ComponentWrap.prototype.render = function () {\r\n            var _this = this;\r\n            var name = config.name;\r\n            var isReady = this.state.isReady;\r\n            var children = this.props.children;\r\n            return (react_1.default.createElement(context_1.default.Consumer, null, function (el) {\r\n                var _a;\r\n                _this.el = el;\r\n                return (react_1.default.createElement(context_1.default.Provider, { value: (_a = window[name]) === null || _a === void 0 ? void 0 : _a.getChild() }, isReady && window[name] ? children : react_1.default.createElement(react_loading_skeleton_1.default, null)));\r\n            }));\r\n        };\r\n        return ComponentWrap;\r\n    }(react_1.default.Component));\r\n}\r\nexports.createComponent = createComponent;\r\n"],"names":["__extends","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__importDefault","mod","__esModule","default","defineProperty","exports","value","createComponent","react_1","require","react_loading_skeleton_1","context_1","loadScript","script","Promise","resolve","el","document","createElement","addEventListener","src","getElementsByTagName","appendChild","loadLink","link","setAttribute","href","loadRemoteResource","_a","scripts","links","all","concat","map","config","container","_super","Component","ComponentWrap","componentDidMount","_this","history","props","unListen","listen","location","console","log","name","window","bootstrap","refresh","_c","_b","mount","then","setState","isReady","componentDidUpdate","prevProps","prevState","snapshot","state","lock","name_1","update","componentWillUnmount","unmount","forceUpdate","render","children","Consumer","Provider","getChild","call","bind"],"mappings":"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"}