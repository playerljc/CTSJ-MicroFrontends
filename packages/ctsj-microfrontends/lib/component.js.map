{"version":3,"file":"component.js","sources":["component.js"],"sourcesContent":["var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport React from 'react';\r\nimport Skeleton from 'react-loading-skeleton';\r\nimport Context from './context';\r\nimport Util from './util';\r\nimport { routerChangeEmitter } from './emit/emitter';\r\nimport { ROUTER_CHANGE } from './emit/actions';\r\n/**\r\n * createComponent - 创建路由组件\r\n * @param config\r\n * @param container\r\n * @return React.ReactElement\r\n */\r\nexport function createComponent(config, container) {\r\n    /**\r\n     * RouterComponent - 路由组件\r\n     * @class RouterComponent\r\n     * @classdesc RouterComponent\r\n     */\r\n    // @ts-ignore\r\n    return /** @class */ (function (_super) {\r\n        __extends(RouterComponent, _super);\r\n        function RouterComponent(props) {\r\n            var _this = _super.call(this, props) || this;\r\n            _this.el = null;\r\n            _this.lock = false;\r\n            // 之前变化的location\r\n            _this.preChangeLocation = null;\r\n            _this.state = {\r\n                isReady: false,\r\n            };\r\n            // 路由发生变化的回调\r\n            _this.onLocationChange = _this.onLocationChange.bind(_this);\r\n            _this.refresh = _this.refresh.bind(_this);\r\n            return _this;\r\n        }\r\n        RouterComponent.prototype.componentDidMount = function () {\r\n            var _this = this;\r\n            var _a, _b, _c;\r\n            // 1.接收到props中的history对象\r\n            var history = this.props.history;\r\n            // 2. 使用history的listen方法添加自定义监听事件 参数为一个回调函数 即：路由改变之后执行的方法\r\n            this.unListen = history.listen(this.onLocationChange);\r\n            var name = config.name;\r\n            // 如果没有加载远程资源，则加载远程资源\r\n            // @ts-ignore\r\n            if (!window[name]) {\r\n                var scripts = config.scripts, links = config.links;\r\n                Util.loadRemoteResource({\r\n                    scripts: scripts,\r\n                    // @ts-ignore\r\n                    links: links,\r\n                }).then(function () {\r\n                    var _a, _b, _c;\r\n                    // @ts-ignore\r\n                    (_a = window[name]) === null || _a === void 0 ? void 0 : _a.bootstrap({\r\n                        props: _this.props,\r\n                        config: config,\r\n                        el: _this.el || container,\r\n                        refresh: _this.refresh,\r\n                    });\r\n                    // @ts-ignore\r\n                    (_c = (_b = window[name]) === null || _b === void 0 ? void 0 : _b.mount()) === null || _c === void 0 ? void 0 : _c.then(function () {\r\n                        _this.setState({\r\n                            isReady: true,\r\n                        });\r\n                    });\r\n                });\r\n            }\r\n            // 加载过远程资源\r\n            else {\r\n                // @ts-ignore\r\n                (_a = window[name]) === null || _a === void 0 ? void 0 : _a.bootstrap({\r\n                    props: this.props,\r\n                    config: config,\r\n                    el: this.el || container,\r\n                    refresh: this.refresh,\r\n                });\r\n                // @ts-ignore\r\n                (_c = (_b = window[name]) === null || _b === void 0 ? void 0 : _b.mount()) === null || _c === void 0 ? void 0 : _c.then(function () {\r\n                    _this.setState({\r\n                        isReady: true,\r\n                    });\r\n                });\r\n            }\r\n        };\r\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n        RouterComponent.prototype.componentDidUpdate = function (prevProps, prevState, snapshot) {\r\n            // console.log('prevState.isReady', prevState.isReady);\r\n            // console.log('this.state.isReady', this.state.isReady);\r\n            var _a;\r\n            var lock = this.lock;\r\n            if (lock) {\r\n                this.lock = false;\r\n            }\r\n            else if (prevState.isReady === this.state.isReady) {\r\n                var name_1 = config.name;\r\n                // @ts-ignore\r\n                (_a = window[name_1]) === null || _a === void 0 ? void 0 : _a.update(prevProps, this.props);\r\n            }\r\n        };\r\n        RouterComponent.prototype.componentWillUnmount = function () {\r\n            var _a;\r\n            this.unListen();\r\n            var name = config.name;\r\n            // @ts-ignore\r\n            (_a = window[name]) === null || _a === void 0 ? void 0 : _a.unmount();\r\n        };\r\n        /**\r\n         * refresh - 刷新\r\n         */\r\n        RouterComponent.prototype.refresh = function () {\r\n            // 加锁防止自己被update\r\n            this.lock = true;\r\n            this.forceUpdate();\r\n        };\r\n        /**\r\n         * onLocationChange - 路由改变之后执行的方法\r\n         * @param location\r\n         */\r\n        RouterComponent.prototype.onLocationChange = function (location) {\r\n            if (!this.preChangeLocation) {\r\n                this.preChangeLocation = location;\r\n                routerChangeEmitter.trigger(ROUTER_CHANGE, location);\r\n            }\r\n            else if (this.preChangeLocation.pathname !== location.pathname) {\r\n                this.preChangeLocation = location;\r\n                routerChangeEmitter.trigger(ROUTER_CHANGE, location);\r\n            }\r\n        };\r\n        RouterComponent.prototype.render = function () {\r\n            var _this = this;\r\n            var name = config.name;\r\n            var isReady = this.state.isReady;\r\n            var children = this.props.children;\r\n            return (React.createElement(Context.Consumer, null, function (el) {\r\n                var _a;\r\n                _this.el = el;\r\n                return (React.createElement(Context.Provider, { value: (_a = window[name]) === null || _a === void 0 ? void 0 : _a.getChild() }, isReady && window[name] ? children : React.createElement(Skeleton, null)));\r\n            }));\r\n        };\r\n        return RouterComponent;\r\n    }(React.Component));\r\n}\r\n"],"names":["__extends","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","React","Skeleton","Context","Util","routerChangeEmitter","ROUTER_CHANGE","createComponent","config","container","_super","Component","RouterComponent","componentDidMount","_this","history","props","unListen","listen","onLocationChange","scripts","links","name","window","_a","bootstrap","el","refresh","_c","_b","mount","then","setState","isReady","loadRemoteResource","componentDidUpdate","prevProps","prevState","snapshot","lock","state","name_1","update","componentWillUnmount","unmount","forceUpdate","location","preChangeLocation","pathname","trigger","render","children","createElement","Consumer","Provider","value","getChild","call","bind"],"mappings":"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"}